<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1, user-scalable=no">
  <meta name="theme-color" content="#EDEDED">
    <link rel="manifest" href="manifest.json"> <!-- 引用manifest -->
  <title>碎片率计算器</title>
  <style>
    /* 页面和主体样式 */
    html, body {
      margin: 0; /* 去掉默认外边距 */
      padding: 0; /* 去掉默认内边距 */
      background-color: #EDEDED; /* 设置页面背景颜色为浅灰色 */
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
    }

    /* 主内容容器样式 */
    .container {
      width: 90%; /* 宽度为视口宽度的 90% */
      max-width: 400px; /* 最大宽度为 400px */
      background: #fff; /* 背景颜色为白色 */
      padding: 20px; /* 内边距为 20px */
      border-radius: 12px; /* 圆角半径为 12px */
      box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1); /* 添加阴影效果 */
      margin: 40px auto; /* 设置容器垂直和水平居中，上下外边距为 40px */
      box-sizing: border-box; /* 包括内边距在宽高计算内 */
    }

    /* 标题样式 */
    h1 {
      font-size: 20px; /* 字体大小为 20px */
      font-weight: bold; /* 字体加粗 */
      text-align: center; /* 居中对齐 */
      margin-bottom: 20px; /* 下方外边距为 20px */
    }

    /* 输入框组样式 */
    .input-group {
      margin-bottom: 20px; /* 每个输入框之间的间距 */
    }

    label {
      display: block; /* 独占一行 */
      font-size: 16px; /* 字体大小为 16px */
      margin-bottom: 5px; /* 标签下方间距为 5px */
    }

    input[type="text"] {
      width: 100%; /* 占满父容器宽度 */
      padding: 10px; /* 内边距为 10px */
      font-size: 16px; /* 字体大小为 16px */
      border: 1px solid #ccc; /* 边框颜色为浅灰色 */
      border-radius: 8px; /* 圆角半径为 8px */
      box-sizing: border-box; /* 包括内边距在宽高计算内 */
    }

    /* 单选框组样式 */
    .radio-group {
      margin-bottom: 20px; /* 下方间距为 20px */
    }

    .radio-group label {
      font-size: 16px; /* 单选框标签字体大小 */
      margin-right: 10px; /* 单选框右边距 */
    }

    /* 结果样式 */
    .result {
      font-size: 14px; /* 字体大小 */
      font-weight: bold; /* 加粗 */
      color: #333; /* 深灰色文字 */
      text-align: center; /* 居中对齐 */
      margin-top: 20px; /* 上方间距 */
    }

    /* 按钮样式 */
    .button {
      display: block; /* 独占一行 */
      width: 100%; /* 宽度占满父容器 */
      padding: 12px; /* 内边距 */
      font-size: 16px; /* 字体大小 */
      font-weight: bold; /* 加粗 */
      color: #fff; /* 白色文字 */
      background-color: #007aff; /* 蓝色背景 */
      border: none; /* 无边框 */
      border-radius: 8px; /* 圆角半径 */
      cursor: pointer; /* 鼠标悬停样式 */
      margin-top: 10px; /* 上方间距 */
      transition: background-color 0.2s; /* 背景颜色过渡 */
    }

    .button:active {
      background-color: #0051a8; /* 按下时的深蓝色背景 */
    }

    /* 页脚样式 */
    footer {
      background-color: #EDEDED; /* 页脚背景颜色与页面背景一致 */
      padding-bottom: 20px; /* 只设置下方内边距为 20px */
      text-align: center; /* 居中对齐 */
      font-size: 10px; /* 字体大小 */
      color: #666; /* 灰色文字 */
    }
  </style>
</head>
<body>
  <!-- 主内容区域 -->
  <div class="container">
    <h1>碎片率计算器</h1>
    <div class="input-group">
      <label for="machine-id">机台号</label>
      <input type="text" id="machine-id" placeholder="请输入机台号" oninput="filterNumberInput(this)">
    </div>
    <div class="radio-group" onchange="updateSummary()">
      <label><input type="radio" name="machine-type" value="双拼" checked> 双拼</label>
      <label><input type="radio" name="machine-type" value="单拼"> 单拼</label>
    </div>
    <div class="input-group">
      <label for="machine">机跑数</label>
      <input type="text" id="machine" placeholder="请输入机跑数" oninput="filterNumberInput(this)">
    </div>
    <div class="input-group">
      <label for="qualified">合格数</label>
      <input type="text" id="qualified" placeholder="请输入合格数" oninput="filterNumberInput(this)">
    </div>
    <div class="input-group">
      <label for="discard">剔除碎</label>
      <input type="text" id="discard" placeholder="请输入剔除碎" oninput="filterNumberInput(this)">
    </div>
    <div class="result" id="summary">总结：-</div>
    <button class="button" onclick="copySummary()">复制总结</button>
  </div>

  <!-- 页脚 -->
  <footer>
    <p>© 2025 GaryIndex Comes from 
  <a href="https://github.com/GaryIndex" target="_blank" style="text-decoration: none; color: blue;">
    <svg width="12" height="12" viewBox="0 0 48 48" fill="none" xmlns="http://www.w3.org/2000/svg" style="vertical-align: middle; margin-right: 4px;">
      <path fill-rule="evenodd" clip-rule="evenodd" d="M24 4C12.9543 4 4 12.9543 4 24C4 35.0457 12.9543 44 24 44C35.0457 44 44 35.0457 44 24C44 12.9543 35.0457 4 24 4ZM0 24C0 10.7452 10.7452 0 24 0C37.2548 0 48 10.7452 48 24C48 37.2548 37.2548 48 24 48C10.7452 48 0 37.2548 0 24Z" fill="#000000"/>
      <path fill-rule="evenodd" clip-rule="evenodd" d="M19.1833 45.4716C18.9898 45.2219 18.9898 42.9973 19.1833 38.798C17.1114 38.8696 15.8024 38.7258 15.2563 38.3667C14.437 37.828 13.6169 36.1667 12.8891 34.9959C12.1614 33.8251 10.5463 33.64 9.89405 33.3783C9.24182 33.1165 9.07809 32.0496 11.6913 32.8565C14.3044 33.6634 14.4319 35.8607 15.2563 36.3745C16.0806 36.8883 18.0515 36.6635 18.9448 36.2519C19.8382 35.8403 19.7724 34.3078 19.9317 33.7007C20.1331 33.134 19.4233 33.0083 19.4077 33.0037C18.5355 33.0037 13.9539 32.0073 12.6955 27.5706C11.437 23.134 13.0581 20.2341 13.9229 18.9875C14.4995 18.1564 14.4485 16.3852 13.7699 13.6737C16.2335 13.3589 18.1347 14.1343 19.4734 16.0001C19.4747 16.0108 21.2285 14.9572 24.0003 14.9572C26.772 14.9572 27.7553 15.8154 28.5142 16.0001C29.2731 16.1848 29.88 12.7341 34.5668 13.6737C33.5883 15.5969 32.7689 18.0001 33.3943 18.9875C34.0198 19.9749 36.4745 23.1147 34.9666 27.5706C33.9614 30.5413 31.9853 32.3523 29.0384 33.0037C28.7005 33.1115 28.5315 33.2855 28.5315 33.5255C28.5315 33.8856 28.9884 33.9249 29.6465 35.6117C30.0853 36.7362 30.117 39.948 29.7416 45.247C28.7906 45.4891 28.0508 45.6516 27.5221 45.7347C26.5847 45.882 25.5669 45.9646 24.5669 45.9965C23.5669 46.0284 23.2196 46.0248 21.837 45.8961C20.9154 45.8103 20.0308 45.6688 19.1833 45.4716Z" fill="#000000"/>
    </svg>
    GitHub
  </a>
</p>
    <!-- <p>© 2025 GaryIndex Comes from GitHub </p> -->
    <!-- <p>© 2025 GaryIndex Comes from <a href="https://github.com/GaryIndex" target="_blank">GitHub</a></p> -->
     <!-- >p>© 2025 GaryIndex Comes from <a href="https://github.com/GaryIndex" target="_blank" style="text-decoration: none; color: blue;">GitHub</a></p>-->
  </footer>

  <script>
    function filterNumberInput(input) {
      input.value = input.value.replace(/[^0-9]/g, '');
      updateSummary();
    }

    function updateSummary() {
      const machineId = document.getElementById("machine-id").value;
      const machineType = document.querySelector('input[name="machine-type"]:checked').value;
      const machine = parseInt(document.getElementById("machine").value) || 0;
      const qualified = parseInt(document.getElementById("qualified").value) || 0;
      const discard = parseInt(document.getElementById("discard").value) || 0;

      let summary = "总结：";
      if (!machineId || machine <= 0) {
        document.getElementById("summary").innerText = summary + "-";
        return;
      }

      let fragmentCount = 0;
      let fragmentRate = "";
      let resultType = "";

      if (qualified > machine) { 
        const missingPieces = qualified - machine + discard;
        fragmentCount = missingPieces;
        fragmentRate = ((fragmentCount / machine) * 100).toFixed(2) + "%";
        resultType = `少片${fragmentCount} 剔除碎片${discard} 碎片率${fragmentRate}`;
      } else { 
        const extraPieces = machine - qualified - discard;
        if (extraPieces < 0) {
          fragmentCount = Math.abs(extraPieces);
          fragmentRate = ((fragmentCount / machine) * 100).toFixed(2) + "%";
          resultType = `少片${fragmentCount} 剔除碎片${discard} 碎片率${fragmentRate}`;
        } else {
          fragmentCount = extraPieces;
          resultType = `多片${fragmentCount}`;
        }
      }

      summary += `${machineId} ${resultType} ${machineType}`;
      document.getElementById("summary").innerText = summary;
    }

    function copySummary() {
      const summaryText = document.getElementById("summary").innerText.replace("总结：", "").trim();
      if (summaryText === "-") {
        alert("暂无数据可复制！");
        return;
      }

      navigator.clipboard.writeText(summaryText).then(() => {
        alert("总结已复制！");
      }).catch(() => {
        alert("复制失败，请手动复制！");
      });
    }
  </script>
    <script>
  if ('serviceWorker' in navigator) {
  window.addEventListener('load', () => {
    navigator.serviceWorker.register('service-worker.js').then((registration) => {
      console.log('Service Worker 注册成功:', registration);

      // 检查 Service Worker 是否已经激活且缓存完成
      registration.active?.postMessage({ type: 'CACHE_READY' });

      // 确保缓存完成后再加载主内容
      navigator.serviceWorker.ready.then(() => {
        console.log('缓存已准备，加载网页内容...');
        document.body.style.display = 'block'; // 显示网页内容
      });
    }).catch((error) => {
      console.error('Service Worker 注册失败:', error);
      // 如果失败，直接显示网页内容
      document.body.style.display = 'block';
    });
  });
}
  </script>
</body>
</html>